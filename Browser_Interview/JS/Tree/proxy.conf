log_format json escape=json  '{"remote_addr": "$remote_addr", '
                                  '"remote_user": "$remote_user", '
                                  '"time": "$time_local", '
                                  '"timestamp": "$msec", '
                                  '"http_host": "$http_host", '
                                  '"request": "$request", '
                                  '"request_body": "$request_body", '
                                  '"status": "$status", '
                                  '"body_bytes_sent": "$body_bytes_sent", '
                                  '"http_user_agent": "$http_user_agent", '
                                  '"http_cookie": "$http_cookie", '
                                  '"request_time": "$request_time", '
                                  '"http_referer": "$http_referer", '
                                  '"http_x_forwarded_for": "$http_x_forwarded_for", '
                                  '"upstream_status": "$upstream_status", '
                                  '"upstream_time": "$upstream_response_time"}';
log_format recalljson escape=json  '{"remote_addr": "$remote_addr", '
                                       '"remote_user": "$remote_user", '
                                       '"time": "$time_local", '
                                       '"timestamp": "$msec", '
                                       '"http_host": "$http_host", '
                                       '"request": "$request", '
                                       '"request_body": "$request_body", '
                                       '"status": "$status", '
                                       '"body_bytes_sent": "$body_bytes_sent", '
                                       '"request_length": "$request_length", '
                                       '"http_user_agent": "$http_user_agent", '
                                       '"http_cookie": "$http_cookie", '
                                       '"request_time": "$request_time", '
                                       '"http_referer": "$http_referer", '
                                       '"upstream_status": "$upstream_status"}';

server {
    listen       8092;
    server_name  localhost;

    location / {
        add_header Access-Control-Allow-Origin * always;
        add_header Access-Control-Allow-Headers *;
        add_header Content-Type "application/json; charset=utf-8";
        add_header Access-Control-Allow-Methods "GET, POST, PUT, OPTIONS";
        client_body_buffer_size 2m;
        proxy_pass http://172.21.64.38:8092;
        access_log /var/log/nginx/feihe-nlp.log recalljson;
    }

    location /heartbeats {
        proxy_http_version 1.1;
        proxy_set_header Connection "";#http1.1�~E�~J|
        proxy_set_header Host cess121-cdh-master01;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_connect_timeout 10;
        proxy_send_timeout 30;
        proxy_read_timeout 30;
        proxy_buffer_size 256k;
        proxy_buffers 4 256k;
        proxy_busy_buffers_size 256k;
        proxy_temp_file_write_size 256k;
        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504 http_404;
        proxy_max_temp_file_size 128m;
        proxy_pass http://172.21.64.38:8092;
        access_log /var/log/nginx/feihe-nlp.log json;
    }
}