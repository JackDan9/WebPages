# 浏览器如何工作
- 浏览器可以被认为是使用最为广泛的软件，以下篇幅将介绍浏览器的工作原理，我们将看到，从你在地址栏输入google.com到你看到google主页过程中都发生了什么。

------

## 浏览器的种类介绍
- 今天，有五种主流浏览器 ——— Chrome、Firefox、 IE、 Safari及Opera。
- 本文将基于一些开源浏览器的例子 —— Chrome、Firefox及Safari, Safari是部分开源的。

------

## 浏览器的主要功能
- 浏览器的主要功能是将用户选择得web资源呈现出来，它需要从服务器请求资源，并将其显示在浏览器窗口中，资源的格式通常是HTML，也包括PDF、Image以及其他格式。用户用URI(Uniform Resource Identifier 统一资源标识符)来指定所请求资源的位置。
- HTML和CSS规范中规定了浏览器解释html文档的方式，由W3C组织对这些规范进行维护，W3C是负责制定Web标准的组织
- HTML规范的最新版本是，最新的CSS规范版本是
- 浏览器问世以来，浏览器厂商之间的竞争没有停息过，纷纷开发自己浏览器的拓展，对规范的遵循并不完善，这为web开发者带来了严重的兼容性问题。
- 但是，浏览器的用户界面则差不多，常见的用户界面元素包括:
	- 用来输入URI的地址栏;
	- 前进、后退按钮;
	- 书签选项;
	- 用于刷新以及暂停当前加载文档的刷新、暂停按钮;
	- 用于到达主页的主页按钮.
- 奇怪的是，并没有哪个正式公布的规范对于用户界面做出规定，这些是多年来浏览器厂商之间相互模仿和不断改进的结果.
- HTML5并没有规定浏览器必须具有的UI元素，但列出了一些常用元素, 包括地址栏、状态栏以及工具栏。还有一些浏览器有自己专有的功能，比如firefox的下载管理。

------

## 浏览器的主要构成High Level Structure
- 浏览器的主要组件包括:
	- 1. 用户界面 —— 包括地址栏、后退/前进按钮、书签目录等，也就是你所看到的除了用来显示你所请求页面的主窗口之外的其他部分;
	- 2. 浏览器引擎 —— 用来查询以及操作渲染引擎的接口;
	- 3. 渲染引擎 —— 用来显示请求的内容，例如，如果请求内容为html，它负责解析html以及css，并将解析后的结果显示出来;
	- 4. 网络 —— 用来完成网络调用，例如http请求，它具有与平台无关的接口进行通信的功能，可以在不同平台上工作;
	- 5. UI(User Interface)后端 —— 用来绘制类似组合选择框及对话框等基本组件，具有不特定某个平台的通用接口，底层使用操作系统的用户接口;
	- 6. JS解释器 —— 用来解释执行JS代码
	- 7. 数据存储 —— 属于持久层，浏览器需要在硬盘中保存类似cookie的各种数据，HTML5定义了web database技术，这是一种轻量级完整的客户端存储技术。
> 需要注意的是, Google Chrome浏览器不同于大部分浏览器，Google Chrome浏览器为每个Tab分配了各自的渲染引擎实例，每个Tab就是一个独立的进程。

- 对于构成浏览器的这些组件详细原理分析，后面会持续更新。

------

## 组件间的通信Communication between the components
- Firefox和Chrome都开发了一个特殊的通信结构，后面会详细讨论

------

## 渲染引擎 The rendering engine
- 渲染引擎的职责就是渲染，即在浏览器窗口中显示所请求的内容。
- 默认情况下，渲染引擎可以显示html、xml文档以及图片，它也可以借助插件(一种浏览器扩展)显示其他类型数据，例如使用PDF阅读器插件，可以显示PDF格式，将由专门一章讲解插件以及其扩展，这里只讨论渲染引擎最主要的用途——显示应用了CSS之后的html以及图片。

### 渲染引擎 Rendering engines
- 本文所讨论的浏览器——Firefox、Chrome和Safari是基于两种渲染引擎构建的，Firefox基于Geoko——Firefox公司自主研发的一款渲染引擎，Safari和Chrome是基于Webkit。
- Webkit是一款开源渲染引擎，它本来是为Linux平台研发的，后来由Apple移植到Mac以及Windows上，Webkit参考http://webkit.org

### 主流程 The main flow
- 渲染引擎首先通过网络获取所请求文档的内容，通常以8K分块的方式完成。

#### 下面是渲染引擎在取得内容之后的基本流程
- **解析html以构建dom树**->**构建render树**->**布局render树**->**绘制render树**
- 如下图所示:

- 渲染引擎开始解析html，并将标签转换为内容树中的dom节点。接着，它解析外部CSS文件以及style标签中的样式信息。这些样式信息以及html中的可见性指令将被用来构建另一棵树——render树;
- render树由一些包含有颜色和大小等属性的矩形组成，它们将被按照正常的顺序显示到屏幕上。
- render树构建好了之后，将会执行布局过程，它将确定每个节点在屏幕上的确切坐标。 再下一步就是绘制，即遍历render树，并使用UI后端层绘制每个节点。
- 值得注意的是，这个过程是逐步完成的，为了更好的用户体验，渲染引擎将会尽可能早的将内容呈现到屏幕上，并不会等到所有的html都解析完成之后再去构建和布局render树。它是解析完一部分内容就显示一部分内容，同时，可能还在通过网络下载其余内容。
- 从图3和图4中可以看出，尽管webkit和Gecko使用的术语稍有不同，


